name: Redirect PRs to Develop

on:
  pull_request:
    types: [opened]
    branches: [main]

jobs:
  redirect:
    runs-on: ubuntu-latest
    # Don't run on PRs from develop (those are promotions)
    if: github.head_ref != 'develop'

    permissions:
      pull-requests: write

    steps:
      - name: Comment and close PR
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PR_NUMBER: ${{ github.event.pull_request.number }}
          HEAD_REF: ${{ github.head_ref }}
        run: |
          # Add comment explaining the redirect
          gh pr comment $PR_NUMBER --body "## ðŸ”„ PR Redirected to \`develop\`

          This repository follows a **develop â†’ main** workflow:

          1. All feature PRs should target the \`develop\` branch
          2. The \`main\` branch only receives promotions from \`develop\`

          ### What to do:

          Please close this PR and open a new one targeting \`develop\`:

          \`\`\`bash
          gh pr create --base develop --head ${HEAD_REF}
          \`\`\`

          Or use the GitHub UI to create a new PR with base branch set to \`develop\`.

          ---
          *This PR will be automatically closed.*"

          # Close the PR
          gh pr close $PR_NUMBER

          echo "PR #$PR_NUMBER closed and redirected to develop"
