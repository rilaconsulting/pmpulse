name: Redirect PRs to Develop

on:
  pull_request:
    types: [opened]
    branches: [main]

jobs:
  redirect:
    runs-on: ubuntu-latest
    # Don't run on PRs from develop (those are promotions)
    if: github.head_ref != 'develop'

    permissions:
      pull-requests: write

    steps:
      - name: Change PR base to develop
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PR_NUMBER: ${{ github.event.pull_request.number }}
          REPO: ${{ github.repository }}
        run: |
          # Change the base branch to develop
          gh pr edit $PR_NUMBER --repo $REPO --base develop

          # Add comment explaining the change
          gh pr comment $PR_NUMBER --repo $REPO --body "## ðŸ”„ PR Base Changed to \`develop\`

          This repository follows a **develop â†’ main** workflow:

          1. All feature PRs should target the \`develop\` branch
          2. The \`main\` branch only receives promotions from \`develop\`

          The base branch has been automatically changed from \`main\` to \`develop\`."

          echo "PR #$PR_NUMBER base changed to develop"
