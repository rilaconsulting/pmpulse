name: Redirect PRs to Develop

on:
  pull_request:
    types: [opened]
    branches: [main]

jobs:
  redirect:
    runs-on: ubuntu-latest
    # Don't run on PRs from develop (those are promotions)
    if: github.head_ref != 'develop'

    permissions:
      pull-requests: write

    steps:
      - name: Comment and close PR
        uses: actions/github-script@v7
        with:
          script: |
            const { owner, repo } = context.repo;
            const prNumber = context.payload.pull_request.number;
            const headRef = context.payload.pull_request.head.ref;

            // Add comment explaining the redirect
            await github.rest.issues.createComment({
              owner,
              repo,
              issue_number: prNumber,
              body: `## ðŸ”„ PR Redirected to \`develop\`

            This repository follows a **develop â†’ main** workflow:

            1. All feature PRs should target the \`develop\` branch
            2. The \`main\` branch only receives promotions from \`develop\`

            ### What to do:

            Please close this PR and open a new one targeting \`develop\`:

            \`\`\`bash
            # Update your branch to target develop
            gh pr create --base develop --head ${headRef}
            \`\`\`

            Or use the GitHub UI to create a new PR with base branch set to \`develop\`.

            ---
            *This PR will be automatically closed.*`
            });

            // Close the PR
            await github.rest.pulls.update({
              owner,
              repo,
              pull_number: prNumber,
              state: 'closed'
            });

            console.log(`PR #${prNumber} closed and redirected to develop`);
